<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge;" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PrimeActs</title>
    <link rel="shortcut icon" type="image/png" href="~/favicon.ico" />
    @Scripts.Render("~/bundles/modernizr")
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    @Scripts.Render("~/bundles/knockout")
    <script src="~/Scripts/bootbox.js"></script>

    @Styles.Render("~/Content/css/PrimeActsStyles")
    @Styles.Render("~/Content/css/PagedList")
    @Styles.Render("~/Content/css/app")
    @Styles.Render("~/Content/css/jquerycss")
</head>
<body>
    
    <table id="stockboard1" class="table table-striped">
        <thead><tr>
                <td>Produce</td>
                   @*<td>ProduceGroup</td>*@
                   <td>Qty Available</td>
                   <td>Rel Consignments/Tickets</td>
                   
            </tr></thead>
        
        <tbody data-bind="foreach: {data: stockboard1.producestocks, as: 'producerow'}">
            <tr class="producerowdisplay">
                <td><span data-bind="text:producerow.ProduceName"></span></td>
               <td><span data-bind="text:producerow.QuantityAvailable"></span></td>
                <td><span data-bind="text:producerow.QuantityExpected"></span></td>


              
            </tr>
        </tbody>
    </table>
    <span id="stockboard2"></span>

    <!--Script references. -->
    <!--Reference the jQuery library. -->
    <script src="~/Scripts/jquery-2.2.3.min.js"></script>
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.0.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--Reference the LiveStockBoard Type script. -->
    <script src="~/TypeScripts/StockBoard/DisplayStockboard.js"></script>

    <script>
        var stockboard1 = new StockboardHub();
        var connection = $.connection;

      
        

        //Add a client side method for hub to call and update the stocks.
       
        connection.liveStockboardMini.client.refreshPage = function () {
          
            $.ajax({
                type: 'GET',
                url: "/api/StockBoard/LatestStocks",
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                cache: false,
                data: {
                    json: '{}',
                    delay: 0.1
                },
                success: function (data) {
                    
                    //$("table.stockboard1").replaceAll(data);
                    
                    var replacementText = "<tbody>";
                    
                    for (var y in data) {
                        replacementText = replacementText + 
                            "<tr><td><span>" + data[y].ProduceName + "</span></td>" +
                                "<td><span>" + data[y].QuantityAvailable + "</span></td>" +
                              "<td><span>" + data[y].QuantityExpected + "</span></td></tr>";
                        
                    }
                    replacementText = replacementText + "</tbody>";
                    $("tbody").replaceWith(replacementText);
                   
                },
                error: function (jqXHR, textStatus, error) {
                  alert(error);

                }
              
           
            });
            //alert("hellow Aruna stockboard");

        };
        
        connection.hub.logging = true;

        //start the hub connection
        connection.hub.start().done(function (result) {
            //call the method on the hub server to fetch the data.
                    connection.liveStockboardMini.server.getProducesforStockBoard().done(function (result) {
                        for (var x in result) {
                            //push data to page.
                            
                            stockboard1.producestocks.push(result[x]);
                         
                    
                        }
                
         
                    });

            //Client side refresh data method.  Ajax call to /API/stockboard/lateststocks
   
            
            //connection.liveStockboardMini.client.updateStocks();

            ko.applyBindings(stockboard1);


            // ko.applyBindings(stockboard1);
            //ko.applyBindings(stockboard);
        });
        

    </script>
</body>
</html>

